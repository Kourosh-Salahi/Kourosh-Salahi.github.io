<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS180 Project 1 â€” Colorizing the Prokudinâ€‘Gorskii Photo Collection</title>
  <meta name="description" content="CS180 Proj1: Singleâ€‘scale & multiâ€‘scale (image pyramid) alignment with L2/NCC" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020;
      --card: #111836;
      --muted: #a0aec0;
      --ink: #e6eefc;
      --accent: #8ab4ff;
      --accent2: #70f3c4;
      --ring: rgba(138, 180, 255, 0.45);
      --ok: #70f3c4;
      --warn: #f5b971;
      --bad: #f87171;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink); background: radial-gradient(1200px 600px at 20% -10%, #18224a 0%, transparent 60%),
                          radial-gradient(900px 500px at 120% 10%, rgba(112,243,196,0.15) 0%, transparent 60%),
                          var(--bg);
      line-height: 1.6;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 20px; }
    header {
      padding: 48px 0 24px; position: sticky; top: 0; backdrop-filter: saturate(150%) blur(10px);
      background: linear-gradient(to bottom, rgba(11,16,32,0.8), rgba(11,16,32,0.3), transparent);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      z-index: 20;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand .dot { width: 10px; height: 10px; border-radius: 999px; background: linear-gradient(135deg, var(--accent), var(--accent2)); box-shadow: 0 0 0 6px rgba(138,180,255,0.15); }
    .brand h1 { font-size: 18px; margin: 0; font-weight: 800; letter-spacing: 0.2px; }

    .hero { padding: 32px 0 12px; }
    .title { font-size: clamp(28px, 4vw, 44px); line-height: 1.1; margin: 6px 0 10px; font-weight: 800; }
    .subtitle { color: var(--muted); max-width: 75ch; }
    .meta { margin-top: 10px; color: #cbd5e1; font-size: 14px; display:inline-flex; gap: 12px; align-items:center; flex-wrap: wrap; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); }

    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 18px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    .section { margin: 30px 0; }
    .section h2 { margin: 0 0 8px; font-size: clamp(22px, 3vw, 28px); }
    .section p.lead { margin-top: 0; color: #cbd5e1; }

    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 860px) { .grid.two { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 860px) { .grid.three { grid-template-columns: 1fr 1fr 1fr; } }

    figure { margin: 0; display: grid; gap: 8px; }
    figure img, video { width: 100%; height: auto; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); display:block; }
    figcaption { font-size: 14px; color: var(--muted); }

    /* Details */
    .details { display: grid; gap: 8px; margin-top: 8px; }
    .details .row { display:flex; gap:10px; flex-wrap:wrap }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 12px; padding: 2px 6px; border-radius: 6px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1) }

    /* Tables */
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.08); text-align: left; }
    th { font-weight: 700; }
    .ok { color: var(--ok); }
    .warn { color: var(--warn); }
    .bad { color: var(--bad); }

    /* Footer */
    footer { margin: 40px 0 60px; color: var(--muted); text-align: center; font-size: 14px; }

    /* Lightbox */
    .lightbox img { cursor: zoom-in; }
    .lightbox.open { position: fixed; inset: 0; background: rgba(7,10,22,0.85); display: grid; place-items: center; padding: 40px; z-index: 50; }
    .lightbox.open img { max-width: min(1200px, 92vw); max-height: 90vh; border-radius: 18px; box-shadow: 0 20px 60px rgba(0,0,0,0.55); cursor: zoom-out; }

    /* Callouts */
    .callout { border-left: 3px solid var(--accent); padding: 10px 14px; background: rgba(255,255,255,0.04); border-radius: 8px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    pre { padding: 14px; border-radius: 12px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); overflow:auto }

    /* Chips */
    .chip { display:inline-flex; align-items:center; gap:8px; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); font-size:12px }
      @media (min-width: 1100px) { .grid.four { grid-template-columns: 1fr 1fr 1fr 1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <span class="dot" aria-hidden="true"></span>
      <h1>CS180 Â· Project 1</h1>
      <nav style="margin-left:auto;font-size:14px;display:flex;gap:12px">
        <a href="../">Home</a>
        <a href="../0/">Project 0</a>
        <a href="#results-single">Singleâ€‘Scale</a>
        <a href="#results-pyramid">Pyramid</a>
        <a href="#bells">Bells & Whistles</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="card">
        <h2 class="title">Colorizing the Prokudinâ€‘Gorskii Photo Collection</h2>
        <p class="subtitle">Aligning three monochrome glassâ€‘plate channels (B, G, R) into vivid color images using singleâ€‘scale search and coarseâ€‘toâ€‘fine image pyramids. Used NCC in alignment algorithm.</p>
        <div class="meta">
          <span class="pill">Course: CS180 â€” Intro to Computer Vision & Computational Photography</span>
          <span class="pill">Project #1</span>
          <span class="pill">Author: <strong>Kourosh Salahi</strong></span>
          <span class="pill">Due: Sep 12, 2025 â€¢ 11:59 PM</span>
        </div>
      </div>
    </section>

    <!-- Overview / Key Ideas -->
    <section class="section">
      <div class="card">
        <h2>Overview & Key Ideas</h2>
        <p class="lead">Given three images taken in black and white which have R, G, and B filters put on the lenses of the camera, we can use the intensities of the pixel brightness and these three images to reconstruct a color image. Utilizing an alignment algorithm, this was accomplished.</p>
        <div class="grid two">
          <figure class="lightbox" onclick="openLightbox(event)">
            <img src="./media/cathedral.jpg" alt="Example glass plate (BGR from top to bottom)." loading="lazy" />
            <figcaption>Input glass plate (topâ†’bottom = B, G, R).</figcaption>
          </figure>
          <figure class="lightbox" onclick="openLightbox(event)">
            <img src="./media/cathedral_recolored.jpg" alt="Aligned and colorized output image." loading="lazy" />
            <figcaption>Output after alignment & composition.</figcaption>
          </figure>
        </div>
        <div class="details">
          <div class="callout">
            <strong>Scoring metrics.</strong> I implemented <span class="chip">NCC</span> as the scoring metric. This worked well throughout.
          </div>
        </div>
      </div>
    </section>

<section class="section" id="method">
<div class="card">
<h2>Method</h2>
<p class="lead">Below is the endâ€‘toâ€‘end pipeline I used. It starts with a simple translationâ€‘only matcher and extends it with a pyramid for efficiency and robustness on highâ€‘resolution plates.</p>
<div class="grid two">
<div>
<h3 style="margin:0 0 6px">1) Preprocessing</h3>
<ul style="margin-top:8px">
<li><strong>Split B/G/R:</strong> Each input plate is divided into three equal vertical slices in Bâ†’Gâ†’R order.</li>
<li><strong>Type/scale:</strong> Convert to <code>float</code> in [0,1] to make metrics comparable across images.</li>
<li><strong>Interior crop for scoring:</strong> Ignore ~10% borders on each side when computing alignment scores to avoid frame artifacts and scan edges.</li>
<li><strong>Optional normalization for NCC:</strong> Subtract mean and divide by std of the crop; improves stability under exposure shifts.</li>
</ul>


<h3 style="margin:12px 0 6px">2) Singleâ€‘Scale Exhaustive Search</h3>
<ul>
<li>For each channel <em>C âˆˆ {G,R}</em>, search integer displacements <code>(dx,dy) âˆˆ [âˆ’w,w]</code>.</li>
<li><strong>L2 (SSD):</strong> <code>â€–Bâˆ’Câ€–Â²</code> on the interior crop. Lower is better.</li>
<li><strong>NCC:</strong> <code>âŸ¨BÌ‚, ÄˆâŸ© = (Bâˆ’Î¼B)Â·(Câˆ’Î¼C) / (â€–Bâˆ’Î¼Bâ€–â€–Câˆ’Î¼Câ€–)</code>. Higher is better.</li>
<li>Pick the displacement with the best score and record <code>(dx,dy)</code> for Gâ†’B and Râ†’B.</li>
</ul>


<h3 style="margin:12px 0 6px">3) Coarseâ€‘toâ€‘Fine Image Pyramid</h3>
<ul>
<li><strong>Build pyramid:</strong> Repeatedly downsample by 2 (with antiâ€‘aliasing) until <code>min(H,W) â‰² 200</code>.</li>
<li><strong>Coarsest match:</strong> Run the singleâ€‘scale matcher to get an initial <code>(dx,dy)</code>.</li>
<li><strong>Upscale & refine:</strong> Multiply displacements by 2 when moving up a level and refine in a small window (e.g., Â±4) around the upscaled estimate.</li>
<li><strong>Rationale:</strong> The pyramid reduces the number of candidate shifts dramatically while avoiding local minima from large motions.</li>
</ul>


<h3 style="margin:12px 0 6px">4) Composition</h3>
<ul>
<li>Shift G and R by the chosen displacements using <code>np.roll</code> (or equivalent) and stack channels into <code>[R,G,B]</code>.</li>
<li>For visualization, optionally crop outer margins to remove wraparound introduced by shifting.</li>
</ul>
</div>
<div>
<h3 style="margin:0 0 6px">Scoring Notes & Design Choices</h3>
<ul>
<li><strong>Metric choice:</strong> NCC is generally more robust when channels have different brightness/contrast; L2 serves as a simple baseline.</li>
<li><strong>Interior crop:</strong> Ignoring borders prevents frame edges from dominating the score and helps with plates that include thick margins.</li>
<li><strong>Gradients (optional):</strong> On very challenging images, comparing Sobel/Scharr edge maps instead of raw intensities reduces sensitivity to color/exposure differences.</li>
<li><strong>Vectorization:</strong> All perâ€‘candidate scores are computed with NumPy operations; loops only iterate over candidate shifts.</li>
</ul>


<h3 style="margin:12px 0 6px">Complexity & Performance</h3>
<ul>
<li>Singleâ€‘scale cost is <code>O((2w+1)^2 Â· H Â· W)</code> per channel; the pyramid cuts both the search window and image size at coarse levels.</li>
<li>With fixed parameters across the dataset, runtime stays practical while meeting the assignment guidance (aim &lt;â‰ˆ 1 min/image).</li>
</ul>


<h3 style="margin:12px 0 6px">Pseudocode (High Level)</h3>
<pre><code>def match_single_scale(B, C, metric, win, crop=0.10):
best = (0, 0); best_score = -inf if metric=='ncc' else +inf
for dy in range(-win, win+1):
for dx in range(-win, win+1):
s = score(B, shift(C, dx, dy), metric, crop)
if better(s, best_score, metric):
best, best_score = (dx, dy), s
return best


def match_pyramid(B, C, metric, win=15, refine=4):
if min(B.shape) &lt; 200:
return match_single_scale(B, C, metric, win)
Bc, Cc = downsample(B), downsample(C)
dx, dy = match_pyramid(Bc, Cc, metric, win, refine)
dx, dy = 2*dx, 2*dy
ddx, ddy = local_refine(B, C, metric, (dx, dy), refine)
return dx+ddx, dy+ddy</code></pre>
</div>
</div>
</div>
</section>

    <!-- Results: Single Scale -->
<!-- Results: Single Scale -->
<section class="section" id="results-single">
<div class="card">
<h2>Results â€” Singleâ€‘Scale (Lowâ€‘Res JPEGs)</h2>
<p class="lead">These are the single scale images, which were constructed very quickly.</p>
<div class="grid three">
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/cathedral_recolored.jpg" alt="cathedral â€” single-scale result" loading="lazy" />
<figcaption>
<strong>cathedral.jpg</strong><br>
Râ†’B: <code>(3, 12)</code> â€¢ Gâ†’B: <code>(2, 5)</code> â€¢ <em>metric:</em> <span class="chip">NCC</span>
</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/monastery_recolored.jpg" alt="monastery â€” single-scale result" loading="lazy" />
<figcaption>
<strong>monastery.jpg</strong><br>
Râ†’B: <code>(2, 3)</code> â€¢ Gâ†’B: <code>(2, -3)</code> â€¢ <em>metric:</em> <span class="chip">NCC</span>
</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/tobolsk_recolored.jpg" alt="tobolsk â€” single-scale result" loading="lazy" />
<figcaption>
<strong>tobolsk.jpg</strong><br>
Râ†’B: <code>(3, 6)</code> â€¢ Gâ†’B: <code>(3, 3)</code> â€¢ <em>metric:</em> <span class="chip">NCC</span>
</figcaption>
</figure>
</div>
</div>
</section>


<!-- Results: Pyramid -->
<section class="section" id="results-pyramid">
<div class="card">
<h2>Results â€” Multiâ€‘Scale Pyramid (Mandatory Set)</h2>
<p class="lead"><em>Placeholder:</em> This is where you would summarize the pyramid results and overall performance on the required images.</p>
<div class="grid three" style="margin-bottom:12px">
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/church_recolored.jpg" alt="church â€” pyramid result" loading="lazy" />
<figcaption><strong>church.tif</strong> â€” A beatiful church.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/emir_recolored.jpg" alt="emir â€” pyramid result" loading="lazy" />
<figcaption><strong>emir.tif</strong> â€” A man with significant swagger. Slight misalignment visible.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/harvesters_recolored.jpg" alt="harvesters â€” pyramid result" loading="lazy" />
<figcaption><strong>harvesters.tif</strong> â€” A group of harvesters in a field.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/icon_recolored.jpg" alt="icon â€” pyramid result" loading="lazy" />
<figcaption><strong>icon.tif</strong> â€” An extravagant scene. </figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/italil_recolored.jpg" alt="italil â€” pyramid result" loading="lazy" />
<figcaption><strong>italil.tif</strong> â€” Another beautiful image.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/lastochikino_recolored.jpg" alt="lastochikino â€” pyramid result" loading="lazy" />
<figcaption><strong>lastochikino.tif</strong> â€” Mountain side.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/lugano_recolored.jpg" alt="lugano â€” pyramid result" loading="lazy" />
<figcaption><strong>lugano.tif</strong> â€” Peaceful Lake.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/melons_recolored.jpg" alt="melons â€” pyramid result" loading="lazy" />
<figcaption><strong>melons.tif</strong> â€” A melon seller. Significant swagger here as well. </figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/self_portrait_recolored.jpg" alt="self portrait â€” pyramid result" loading="lazy" />
<figcaption><strong>self_portrait.tif</strong> â€” Cool guy in a field.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/siren_recolored.jpg" alt="siren â€” pyramid result" loading="lazy" />
<figcaption><strong>siren.tif</strong> â€” Pretty flowers.</figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/three_generations_recolored.jpg" alt="three generations â€” pyramid result" loading="lazy" />
<figcaption><strong>three_generations.tif</strong> â€” A happy family.</figcaption>
</figure>
</div>
<div class="card" style="margin-top:12px">
<table>
<thead>
<tr>
<th>Image</th>
<th>Metric</th>
<th>Gâ†’B (dx, dy)</th>
<th>Râ†’B (dx, dy)</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr><td>church.tif</td><td>NCC</td><td>(4, 25)</td><td>(-4, 58)</td><td class="ok">OK</td></tr>
<tr><td>emir.tif</td><td>NCC</td><td>(24, 49)</td><td>(55, 103)</td><td class="warn">Note</td></tr>
<tr><td>harvesters.tif</td><td>NCC</td><td>(16, 59)</td><td>(13, 123)</td><td class="ok">OK</td></tr>
<tr><td>icon.tif</td><td>NCC</td><td>(17, 41)</td><td>(23, 89)</td><td class="ok">OK</td></tr>
<tr><td>italil.tif</td><td>NCC</td><td>(21, 38)</td><td>(35, 76)</td><td class="ok">OK</td></tr>
<tr><td>lastochikino.tif</td><td>NCC</td><td>(-2, -2)</td><td>(-8, 75)</td><td class="ok">OK</td></tr>
<tr><td>lugano.tif</td><td>NCC</td><td>(-16, 41)</td><td>(-29, 92)</td><td class="ok">OK</td></tr>
<tr><td>melons.tif</td><td>NCC</td><td>(10, 81)</td><td>(13, 178)</td><td class="ok">OK</td></tr>
<tr><td>self_portrait.tif</td><td>NCC</td><td>(29, 78)</td><td>(37, 176)</td><td class="ok">OK</td></tr>
<tr><td>siren.tif</td><td>NCC</td><td>(-6, 49)</td><td>(-25, 95)</td><td class="ok">OK</td></tr>
<tr><td>three_generations.tif</td><td>NCC</td><td>(14, 53)</td><td>(11, 112)</td><td class="ok">OK</td></tr>
</tbody>
</table>
</div>
</div>
</section>


<!-- Extra Images from LoC -->
<!-- Extra Images from LoC -->
<section class="section" id="extras">
<div class="card">
<h2>Additional Examples â€” My Own LoC Selections</h2>
<p class="lead">These four were chosen from the online collection.</p>
<div class="grid four">
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/mosque_recolored.jpg" alt="mosque â€” selection" loading="lazy" />
<figcaption><strong>mosque.tif</strong> â€” A deserted mosque â€” Râ†’B: <code>(11, 70)</code> â€¢ Gâ†’B: <code>(10, 26)</code></figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/camel_recolored.jpg" alt="camel â€” selection" loading="lazy" />
<figcaption><strong>camel.tif</strong> â€” A man and his camel â€” Râ†’B: <code>(38, 80)</code> â€¢ Gâ†’B: <code>(15, 19)</code></figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/mat_recolored.jpg" alt="mat â€” selection" loading="lazy" />
<figcaption><strong>mat.tif</strong> â€” A woman standing on a mat â€” Râ†’B: <code>(55, 107)</code> â€¢ Gâ†’B: <code>(38, 48)</code></figcaption>
</figure>
<figure class="lightbox" onclick="openLightbox(event)">
<img src="./media/fire_recolored.jpg" alt="fire â€” selection" loading="lazy" />
<figcaption><strong>fire.tif</strong> â€” People sitting around a fire â€” Râ†’B: <code>(-39, 82)</code> â€¢ Gâ†’B: <code>(-11, 44)</code></figcaption>
</figure>
</div>
</div>
</section>
    <!-- Failures / Analysis -->
    <section class="section" id="failures">
      <div class="card">
        <h2>Failure Cases & Analysis</h2>
        <p class="lead">Some images had slight alignment effects that can be attributed to people, animals, or scenes such as water moving in between shots. The only image that seemed to fail completely in aligning was the image of the Emir. I believe this to be due to the following:</p>
        <ul>
          <li><em>Image artifacts:</em> Some channels had scratches while others didn't potentiually causing the optimization function to try to match patterns that didnt actually correspond to real things in the image</li>
          <li><em>Cross channel brightness</em>The Emir, in his eternal swagger, has a very bright garment, which appears very differently across the different color channels (very bright in Blue and very dark in Red).</li>
        </ul>
      </div>
    </section>

    <!-- Repro / Notes -->
    <section class="section" id="repro">
      <div class="card">
        <h2>Reproducibility & Notes</h2>
        <ul>
          <li>While the code for this is not publically available, I encourage those who stumble upon this and are not part of CS180 to attempt reimplementing this. It is a very fun exercise! </li>
        </ul>
      </div>
    </section>

    <!-- Thanks -->
    <section class="section">
      <div class="card">
        <h2>Thanks for reading! ðŸ“·ðŸ§®</h2>
        <p class="lead">I hope you enjoyed reading about my project and viewing these beautiful images :)</p>
      </div>
    </section>
  </main>

  <footer class="container">
    <p>
      Prepared for CS180 Project 1 by Kourosh Andrew Salahi. Images: Prokudinâ€‘Gorskii Collection (Library of Congress). This page is for presentation only; do not upload image assets to Gradescope.
    </p>
  </footer>

  <script>
    function openLightbox(e) {
      const fig = e.currentTarget;
      fig.classList.add('open');
      function close(ev) {
        if (ev.target.tagName === 'IMG' || ev.target === fig) {
          fig.classList.remove('open');
          fig.removeEventListener('click', close);
        }
      }
      fig.addEventListener('click', close);
    }
  </script>
</body>
</html>
